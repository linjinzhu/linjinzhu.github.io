---
layout: post
title:  "在亚马逊云上使用 Ubuntu 系统实例"
date:   2016-03-17 16:10:08 +0800
categories: ubuntu
---

## 目录

- [远程登录](#远程登录)
- [创建账户](#创建账户)
- [安装软件](#安装软件)

## <span id="远程登录">远程登录</span>

在亚马逊云上创建了实例之前，必须创建一个秘钥对，实例上保留公钥，本地下载私钥。实例安装完毕，默认安装了 ssh server，通过 ssh 方式登录时必须指定服务器对应的私钥才能登录。下面是登录亚马逊实例的本地命令：

	ssh -i "amazon-private.pem" ubuntu@ec2-52-192-155-235.ap-northeast-1.compute.amazonaws.com
	
## <span id="创建账户">创建账户</span>

**设置 root 用户**。Ubuntu 系统安装好之后默认没有 root 账户的密码，第一次启动时需要设置一个 root 密码，使用命令 `sudo passwd` ，会提示你输入两次新密码，这个密码就是 root 账户密码。使用命令 `su root` 即可切换到 root 账户下。

**创建新用户**。使用 `useradd` 创建新用户，etc：

	useradd -d "/home/wusong" -m -s "/bin/bash" wusong
	
**修改用户信息**。使用 `usermod` 更新用户信息，etc：

	usermod wusong -L # 锁定用户
	usermod wusong -U # 解锁用户
	
**删除用户**。使用 `userdel` 删除用户，etc：

	userdel wusong
	
**查看用户信息**。使用 `who`、`whoami` 、`whois`、`finger`。例如执行 `who -a` 命令的输出结果为：
	
	root@ip-172-31-19-15:/home/ubuntu# who -a
    system boot  Mar 17 09:46
    run-level 2  Mar 17 09:46
	LOGIN      tty4         Mar 17 09:46              1057 id=4
	LOGIN      tty5         Mar 17 09:46              1060 id=5
	LOGIN      tty2         Mar 17 09:46              1064 id=2
	LOGIN      tty3         Mar 17 09:46              1065 id=3
	LOGIN      tty6         Mar 17 09:46              1067 id=6
	LOGIN      tty1         Mar 17 09:46              1187 id=1
	LOGIN      ttyS0        Mar 17 09:46              1188 id=tyS0
	ubuntu   + pts/0        Mar 17 09:47   .          1288 (221.219.105.121)

**为用户加系统权限**。执行命令

	sudo vim /etc/sudoers

修改文件如下：

	# User privilege specification
	root ALL=(ALL) ALL
	wusong ALL=(ALL) ALL
保存退出，wusong 用户就拥有了 root 权限。


## <span id="安装软件">安装软件</span>

### 在 Ubuntu 中安装 MySQL。
	
	# 安装 mysql 服务器端
	$ sudo apt-get install mysql-server
	
安装过程中会提示输入 root 账户的密码，输入两次密码。安装完成之后会自动启动，需要检查 Mysql 程序是否正常启动。

	# 检查 MySQL 服务器系统进程
	$ ps -aux|grep mysql
	mysql     2825  0.0  4.9 623920 50420 ?        Ssl  09:55   0:01 /usr/sbin/mysqld
	root      3765  0.0  0.0  10436   928 pts/0    S+   11:01   0:00 grep --color=auto mysql

	# 检查 MySQL 服务器占用端口
	$ netstat -nlt|grep 3306
	tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN
	
	# 通过启动命令检查 MySQL 服务器状态
	$ sudo /etc/init.d/mysql status
	* /usr/bin/mysqladmin  Ver 8.42 Distrib 5.5.47, for debian-linux-gnu on x86_64
	Copyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.
	
	Oracle is a registered trademark of Oracle Corporation and/or its
	affiliates. Other names may be trademarks of their respective
	owners.
	
	Server version		5.5.47-0ubuntu0.14.04.1
	Protocol version	10
	Connection		Localhost via UNIX socket
	UNIX socket		/var/run/mysqld/mysqld.sock
	Uptime:			1 hour 12 min 19 sec
	
	Threads: 1  Questions: 581  Slow queries: 0  Opens: 189  Flush tables: 1  Open tables: 41  Queries per second avg: 0.133
	
	# 通过系统服务命令检查 MySQL 服务器状态
	mysql start/running, process 2825

修改服务器配置。默认情况下，MySQL的字符集是latin1，因此在存储中文的时候，会出现乱码的情况，所以我们需要把字符集统一改成UTF-8。

用 vim 打开 MySQL 服务器的配置文件 my.cnf

	$ sudo vim /etc/mysql/my.cnf
	# 在[client]标签下，增加客户端的字符编码
	[client]
	default-character-set=utf8
	
	# 在[mysqld]标签下，增加服务器端的字符编码
	[mysqld]
	character-set-server=utf8
	collation-server=utf8_general_ci

让 MySQL 可以被远程访问。默认情况下，MySQL 服务器不允许远程访问，只允许本机访问，所以我们需要设置打开远程访问的功能。

	$ sudo vim /etc/mysql/my.cnf
	# 注释掉 bind-address
	#bind-address            = 127.0.0.1
	
修改后，重启MySQL服务器。

	$ sudo /etc/init.d/mysql restart
	* Stopping MySQL database server mysqld                                                                                                                                    [ OK ]
	 * Starting MySQL database server mysqld                                                                                                                                    [ OK ]
	 * Checking for tables which need an upgrade, are corrupt or were
	not closed cleanly.
	
检查修改是否正确。root 用户登录。

	# 查看数据库字符集编码
	$ show variables like '%char%';
	+--------------------------+----------------------------+
	| Variable_name            | Value                      |
	+--------------------------+----------------------------+
	| character_set_client     | utf8                       |
	| character_set_connection | utf8                       |
	| character_set_database   | utf8                       |
	| character_set_filesystem | binary                     |
	| character_set_results    | utf8                       |
	| character_set_server     | utf8                       |
	| character_set_system     | utf8                       |
	| character_sets_dir       | /usr/share/mysql/charsets/ |
	+--------------------------+----------------------------+
	8 rows in set (0.00 sec)
	
	# 检查 MySQL 服务器占用端口
	$ netstat -nlt|grep 3306
	tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN

创建用户，为用户指定可以操作的数据库。

	# 使用 root 账户登录
	$ mysql -uroot -p
	Enter password:
	Welcome to the MySQL monitor.  Commands end with ; or \g.
	Your MySQL connection id is 74
	Server version: 5.5.47-0ubuntu0.14.04.1 (Ubuntu)
	
	Copyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.
	
	Oracle is a registered trademark of Oracle Corporation and/or its
	affiliates. Other names may be trademarks of their respective
	owners.
	
	Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
	
	# 创建 speedtest 数据库
	mysql> create database speedtest;
	Query OK, 1 row affected (0.00 sec)
	
	mysql> use speedtest
	Database changed
	mysql> create table speedtest(id int,name varchar(16) not null);
	Query OK, 0 rows affected (0.01 sec)
	
	# 新建 wusong 用户，密码为 wusong，允许 wusong 可以远程访问 speedtest 数据库，授权 wusong 对 speedtest 进行所有数据库操作
	mysql> GRANT ALL ON speedtest.* to wusong@'%' IDENTIFIED BY 'wusong';
	Query OK, 0 rows affected (0.00 sec)
	
	# 允许 wusong 可以本地访问 speedtest 数据库，授权 wusong 对 speedtest 进行所有数据库操作
	mysql> GRANT ALL ON speedtest.* to wusong@localhost IDENTIFIED BY 'wusong';
	Query OK, 0 rows affected (0.00 sec)
	

检查配置是否生效。

	# 使用 wusong 用户登陆
	$ mysql -uwusong -p
	Enter password:
	Welcome to the MySQL monitor.  Commands end with ; or \g.
	Your MySQL connection id is 75
	Server version: 5.5.47-0ubuntu0.14.04.1 (Ubuntu)
	
	Copyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.
	
	Oracle is a registered trademark of Oracle Corporation and/or its
	affiliates. Other names may be trademarks of their respective
	owners.
	
	Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
	
	mysql> show databases;
	+--------------------+
	| Database           |
	+--------------------+
	| information_schema |
	| speedtest          |
	+--------------------+
	2 rows in set (0.00 sec)
	
重启MySQL
	
更详细的 MySQL 安装和使用信息[点击这里](http://blog.fens.me/linux-mysql-install/)



